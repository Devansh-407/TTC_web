<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Heartfelt Gifts</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .form-section { display: none; }
        .form-section.active { display: block; }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Header -->
    <header class="bg-white shadow-sm border-b">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center">
                    <h1 class="text-2xl font-bold text-gray-900">Admin Panel</h1>
                    <span class="ml-4 px-2 py-1 text-xs font-medium bg-green-100 text-green-800 rounded-full">
                        Live
                    </span>
                </div>
                <div class="text-sm text-gray-500">
                    Real-time Data Management
                </div>
            </div>
        </div>
    </header>

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Navigation Tabs -->
        <div class="mb-8">
            <nav class="flex space-x-1">
                <button onclick="showTab('products')" class="tab-btn px-4 py-2 rounded-lg font-medium text-sm transition-colors bg-blue-600 text-white" data-tab="products">
                    <span class="mr-2">üì¶</span>Products
                </button>
                <button onclick="showTab('categories')" class="tab-btn px-4 py-2 rounded-lg font-medium text-sm transition-colors bg-white text-gray-700 hover:bg-gray-100 border border-gray-300" data-tab="categories">
                    <span class="mr-2">üè∑Ô∏è</span>Categories
                </button>
                <button onclick="showTab('about')" class="tab-btn px-4 py-2 rounded-lg font-medium text-sm transition-colors bg-white text-gray-700 hover:bg-gray-100 border border-gray-300" data-tab="about">
                    <span class="mr-2">‚ÑπÔ∏è</span>About Page
                </button>
            </nav>
        </div>

        <!-- Main Content -->
        <div class="bg-white rounded-lg shadow-sm border">
            <!-- Products Tab -->
            <div id="products-tab" class="tab-content active p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-semibold">Products Management</h2>
                    <button onclick="showProductForm()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                        Add New Product
                    </button>
                </div>

                <div id="product-message" class="hidden mb-4 p-3 bg-green-100 text-green-800 rounded-lg"></div>

                <!-- Product Form -->
                <div id="product-form" class="form-section mb-6 p-4 border rounded-lg bg-gray-50">
                    <h3 class="text-lg font-medium mb-4">Add New Product</h3>
                    <form onsubmit="saveProduct(event)" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <input type="hidden" id="product-id" name="id">
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Name</label>
                            <input type="text" id="product-name" name="name" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Category</label>
                            <select id="product-category" name="category" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                <option value="">Select Category</option>
                            </select>
                        </div>

                        <div class="md:col-span-2">
                            <label class="block text-sm font-medium text-gray-700 mb-1">Description</label>
                            <textarea id="product-description" name="description" rows="3" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"></textarea>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Price (‚Çπ)</label>
                            <input type="number" id="product-price" name="price" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Original Price (‚Çπ)</label>
                            <input type="number" id="product-originalPrice" name="originalPrice" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Image URL</label>
                            <input type="text" id="product-image" name="image" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Customization Level</label>
                            <select id="product-customizationLevel" name="customizationLevel" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                <option value="standard">Standard</option>
                                <option value="premium">Premium</option>
                            </select>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Rating</label>
                            <input type="number" id="product-rating" name="rating" min="0" max="5" step="0.1" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Review Count</label>
                            <input type="number" id="product-reviewCount" name="reviewCount" min="0" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        </div>

                        <div class="md:col-span-2">
                            <label class="flex items-center">
                                <input type="checkbox" id="product-inStock" name="inStock" checked class="mr-2">
                                <span class="text-sm font-medium text-gray-700">In Stock</span>
                            </label>
                        </div>

                        <div class="md:col-span-2 flex gap-3">
                            <button type="submit" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors">Save Product</button>
                            <button type="button" onclick="hideProductForm()" class="px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 transition-colors">Cancel</button>
                        </div>
                    </form>
                </div>

                <!-- Products List -->
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Product</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Category</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Price</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Stock</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="products-list" class="bg-white divide-y divide-gray-200">
                            <!-- Products will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Categories Tab -->
            <div id="categories-tab" class="tab-content p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-semibold">Categories Management</h2>
                    <button onclick="showCategoryForm()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                        Add New Category
                    </button>
                </div>

                <div id="category-message" class="hidden mb-4 p-3 bg-green-100 text-green-800 rounded-lg"></div>

                <!-- Category Form -->
                <div id="category-form" class="form-section mb-6 p-4 border rounded-lg bg-gray-50">
                    <h3 class="text-lg font-medium mb-4">Add New Category</h3>
                    <form onsubmit="saveCategory(event)" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Category Name</label>
                            <input type="text" id="category-name" name="name" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Href URL</label>
                            <input type="text" id="category-href" name="href" placeholder="/gifts?category=anniversary" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        </div>

                        <div class="md:col-span-2">
                            <label class="block text-sm font-medium text-gray-700 mb-1">Description</label>
                            <textarea id="category-description" name="description" rows="3" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"></textarea>
                        </div>

                        <div class="md:col-span-2">
                            <label class="block text-sm font-medium text-gray-700 mb-1">Image URL</label>
                            <input type="text" id="category-image" name="image" placeholder="/category-image.jpg" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        </div>

                        <div class="md:col-span-2 flex gap-3">
                            <button type="submit" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors">Save Category</button>
                            <button type="button" onclick="hideCategoryForm()" class="px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 transition-colors">Cancel</button>
                        </div>
                    </form>
                </div>

                <!-- Categories Grid -->
                <div id="categories-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- Categories will be loaded here -->
                </div>
            </div>

            <!-- About Tab -->
            <div id="about-tab" class="tab-content p-6">
                <div class="mb-6">
                    <h2 class="text-xl font-semibold">About Page Management</h2>
                    <p class="text-gray-600 mt-1">Manage content sections for the About page</p>
                </div>

                <div id="about-message" class="hidden mb-4 p-3 bg-green-100 text-green-800 rounded-lg"></div>

                <!-- About Sections -->
                <div id="about-sections" class="space-y-6">
                    <!-- About sections will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-white border-t mt-12">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
            <div class="text-center text-sm text-gray-500">
                Admin Panel - Real-time Data Management System
            </div>
        </div>
    </footer>

    <script>
        let products = [];
        let categories = [];
        let aboutData = {};
        let editingProduct = null;
        let editingCategory = null;

        // Initialize the admin panel
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
        });

        // Tab management
        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(tabName + '-tab').classList.add('active');
            
            // Update button styles
            document.querySelectorAll('.tab-btn').forEach(btn => {
                if (btn.dataset.tab === tabName) {
                    btn.className = 'tab-btn px-4 py-2 rounded-lg font-medium text-sm transition-colors bg-blue-600 text-white';
                } else {
                    btn.className = 'tab-btn px-4 py-2 rounded-lg font-medium text-sm transition-colors bg-white text-gray-700 hover:bg-gray-100 border border-gray-300';
                }
            });
        }

        // Load all data
        async function loadData() {
            try {
                const [productsRes, categoriesRes, aboutRes] = await Promise.all([
                    fetch('/api/products'),
                    fetch('/api/categories'),
                    fetch('/api/about')
                ]);
                
                products = await productsRes.json();
                categories = await categoriesRes.json();
                aboutData = await aboutRes.json();
                
                renderProducts();
                renderCategories();
                renderAboutSections();
                populateCategorySelect();
            } catch (error) {
                console.error('Error loading data:', error);
            }
        }

        // Products management
        function renderProducts() {
            const tbody = document.getElementById('products-list');
            tbody.innerHTML = products.map(product => `
                <tr class="hover:bg-gray-50">
                    <td class="px-4 py-4">
                        <div class="flex items-center">
                            <img src="${product.image}" alt="${product.name}" class="w-12 h-12 object-cover rounded-lg mr-3">
                            <div>
                                <div class="text-sm font-medium text-gray-900">${product.name}</div>
                                <div class="text-sm text-gray-500">ID: ${product.id}</div>
                            </div>
                        </div>
                    </td>
                    <td class="px-4 py-4 text-sm text-gray-900">${product.category}</td>
                    <td class="px-4 py-4 text-sm text-gray-900">
                        ‚Çπ${product.price}
                        ${product.originalPrice > product.price ? `<span class="ml-2 text-xs text-gray-500 line-through">‚Çπ${product.originalPrice}</span>` : ''}
                    </td>
                    <td class="px-4 py-4">
                        <span class="px-2 py-1 text-xs font-medium rounded-full ${product.inStock ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                            ${product.inStock ? 'In Stock' : 'Out of Stock'}
                        </span>
                    </td>
                    <td class="px-4 py-4 text-sm">
                        <button onclick="editProduct('${product.id}')" class="text-blue-600 hover:text-blue-900 mr-3">Edit</button>
                        <button onclick="deleteProduct('${product.id}')" class="text-red-600 hover:text-red-900">Delete</button>
                    </td>
                </tr>
            `).join('');
        }

        function populateCategorySelect() {
            const select = document.getElementById('product-category');
            select.innerHTML = '<option value="">Select Category</option>' + 
                categories.map(cat => `<option value="${cat.name}">${cat.name}</option>`).join('');
        }

        function showProductForm() {
            document.getElementById('product-form').classList.add('active');
            document.getElementById('product-form').querySelector('h3').textContent = 'Add New Product';
            document.getElementById('product-form').querySelector('button[type="submit"]').textContent = 'Add Product';
            editingProduct = null;
            document.getElementById('product-form').reset();
        }

        function hideProductForm() {
            document.getElementById('product-form').classList.remove('active');
            editingProduct = null;
        }

        function editProduct(productId) {
            const product = products.find(p => p.id === productId);
            if (product) {
                editingProduct = product;
                document.getElementById('product-form').classList.add('active');
                document.getElementById('product-form').querySelector('h3').textContent = 'Edit Product';
                document.getElementById('product-form').querySelector('button[type="submit"]').textContent = 'Update Product';
                
                // Fill form with product data
                document.getElementById('product-id').value = product.id;
                document.getElementById('product-name').value = product.name;
                document.getElementById('product-category').value = product.category;
                document.getElementById('product-description').value = product.description;
                document.getElementById('product-price').value = product.price;
                document.getElementById('product-originalPrice').value = product.originalPrice;
                document.getElementById('product-image').value = product.image;
                document.getElementById('product-customizationLevel').value = product.customizationLevel;
                document.getElementById('product-rating').value = product.rating;
                document.getElementById('product-reviewCount').value = product.reviewCount;
                document.getElementById('product-inStock').checked = product.inStock;
            }
        }

        async function saveProduct(event) {
            event.preventDefault();
            const formData = new FormData(event.target);
            const productData = Object.fromEntries(formData.entries());
            productData.inStock = formData.has('inStock');
            productData.price = Number(productData.price);
            productData.originalPrice = Number(productData.originalPrice);
            productData.rating = Number(productData.rating);
            productData.reviewCount = Number(productData.reviewCount);

            try {
                let updatedProducts;
                if (editingProduct) {
                    updatedProducts = products.map(p => p.id === productData.id ? productData : p);
                } else {
                    productData.id = Date.now().toString();
                    updatedProducts = [...products, productData];
                }

                const response = await fetch('/api/products', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(updatedProducts)
                });

                if (response.ok) {
                    products = updatedProducts;
                    renderProducts();
                    hideProductForm();
                    showMessage('product-message', editingProduct ? 'Product updated successfully!' : 'Product added successfully!');
                }
            } catch (error) {
                console.error('Error saving product:', error);
            }
        }

        async function deleteProduct(productId) {
            if (confirm('Are you sure you want to delete this product?')) {
                try {
                    const updatedProducts = products.filter(p => p.id !== productId);
                    const response = await fetch('/api/products', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(updatedProducts)
                    });

                    if (response.ok) {
                        products = updatedProducts;
                        renderProducts();
                        showMessage('product-message', 'Product deleted successfully!');
                    }
                } catch (error) {
                    console.error('Error deleting product:', error);
                }
            }
        }

        // Categories management
        function renderCategories() {
            const grid = document.getElementById('categories-grid');
            grid.innerHTML = categories.map(category => `
                <div class="border rounded-lg overflow-hidden hover:shadow-lg transition-shadow">
                    <img src="${category.image}" alt="${category.name}" class="w-full h-48 object-cover">
                    <div class="p-4">
                        <h3 class="font-semibold text-lg mb-2">${category.name}</h3>
                        <p class="text-gray-600 text-sm mb-3 line-clamp-2">${category.description}</p>
                        <div class="text-xs text-gray-500 mb-3">${category.href}</div>
                        <div class="flex gap-2">
                            <button onclick="editCategory('${category.name}')" class="flex-1 px-3 py-2 bg-blue-600 text-white text-sm rounded hover:bg-blue-700 transition-colors">Edit</button>
                            <button onclick="deleteCategory('${category.name}')" class="flex-1 px-3 py-2 bg-red-600 text-white text-sm rounded hover:bg-red-700 transition-colors">Delete</button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function showCategoryForm() {
            document.getElementById('category-form').classList.add('active');
            document.getElementById('category-form').querySelector('h3').textContent = 'Add New Category';
            document.getElementById('category-form').querySelector('button[type="submit"]').textContent = 'Add Category';
            editingCategory = null;
            document.getElementById('category-form').reset();
        }

        function hideCategoryForm() {
            document.getElementById('category-form').classList.remove('active');
            editingCategory = null;
        }

        function editCategory(categoryName) {
            const category = categories.find(c => c.name === categoryName);
            if (category) {
                editingCategory = category;
                document.getElementById('category-form').classList.add('active');
                document.getElementById('category-form').querySelector('h3').textContent = 'Edit Category';
                document.getElementById('category-form').querySelector('button[type="submit"]').textContent = 'Update Category';
                
                // Fill form with category data
                document.getElementById('category-name').value = category.name;
                document.getElementById('category-href').value = category.href;
                document.getElementById('category-description').value = category.description;
                document.getElementById('category-image').value = category.image;
            }
        }

        async function saveCategory(event) {
            event.preventDefault();
            const formData = new FormData(event.target);
            const categoryData = Object.fromEntries(formData.entries());

            try {
                let updatedCategories;
                if (editingCategory) {
                    updatedCategories = categories.map(c => c.name === editingCategory.name ? categoryData : c);
                } else {
                    updatedCategories = [...categories, categoryData];
                }

                const response = await fetch('/api/categories', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(updatedCategories)
                });

                if (response.ok) {
                    categories = updatedCategories;
                    renderCategories();
                    populateCategorySelect();
                    hideCategoryForm();
                    showMessage('category-message', editingCategory ? 'Category updated successfully!' : 'Category added successfully!');
                }
            } catch (error) {
                console.error('Error saving category:', error);
            }
        }

        async function deleteCategory(categoryName) {
            if (confirm('Are you sure you want to delete this category?')) {
                try {
                    const updatedCategories = categories.filter(c => c.name !== categoryName);
                    const response = await fetch('/api/categories', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(updatedCategories)
                    });

                    if (response.ok) {
                        categories = updatedCategories;
                        renderCategories();
                        populateCategorySelect();
                        showMessage('category-message', 'Category deleted successfully!');
                    }
                } catch (error) {
                    console.error('Error deleting category:', error);
                }
            }
        }

        // About page management
        function renderAboutSections() {
            const container = document.getElementById('about-sections');
            container.innerHTML = Object.entries(aboutData).map(([key, section]) => `
                <div class="border rounded-lg p-4">
                    <div class="flex justify-between items-center mb-3">
                        <h3 class="font-semibold text-lg capitalize">${key.replace(/([A-Z])/g, ' $1').trim()}</h3>
                        <button onclick="editAboutSection('${key}')" class="px-3 py-1 bg-blue-600 text-white text-sm rounded hover:bg-blue-700 transition-colors">Edit</button>
                    </div>
                    
                    <div class="text-sm text-gray-600">
                        ${getAboutSectionPreview(key, section)}
                    </div>
                </div>
            `).join('');
        }

        function getAboutSectionPreview(key, section) {
            switch (key) {
                case 'hero':
                    return `<p><strong>Title:</strong> ${section.title}</p><p><strong>Subtitle:</strong> ${section.subtitle?.substring(0, 100)}...</p>`;
                case 'story':
                    return `<p><strong>Title:</strong> ${section.title}</p><p><strong>Content:</strong> ${section.content?.substring(0, 100)}...</p>`;
                case 'stats':
                    return `<p><strong>Items:</strong> ${section.items?.length || 0} stat items</p>`;
                case 'cta':
                    return `<p><strong>Title:</strong> ${section.title}</p><p><strong>Button:</strong> ${section.buttonText}</p>`;
                default:
                    return `<p>${JSON.stringify(section, null, 2).substring(0, 200)}...</p>`;
            }
        }

        function editAboutSection(sectionKey) {
            // For now, just show an alert. In a real implementation, you'd open a form.
            alert(`Edit ${sectionKey} section - This would open a form to edit the ${sectionKey} content. For now, you can edit the about.json file directly in the public/data folder.`);
        }

        // Utility functions
        function showMessage(elementId, message) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.classList.remove('hidden');
            setTimeout(() => {
                element.classList.add('hidden');
            }, 3000);
        }
    </script>
</body>
</html>
